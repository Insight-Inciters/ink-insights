<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ink Insights — Dashboard</title>

<link rel="icon" href="assests/Ink-logo.png" type="image/png" />
<link rel="stylesheet" href="dashboard.css">
</head>

<style>
/* ACTIVE NAV LINK */
.navlinks a[aria-current="page"] {
text-shadow:0 0 10px rgba(255,255,255,.35)
}

.navlinks a[aria-current="page"]::after {
  transform: scaleX(1);
  background: #fff;
}


.drawer .menu a[aria-current="page"] {
  border-color: var(--dark-teal);
  color: var(--dark-teal);
  font-weight: 700;
}
</style>

<body>

<!-- ================= HEADER ================= -->
<header class="navbar">
  <div class="nav-inner">
    <div class="brand">
      <a href="index.html">
        <img src="assests/Ink-logo.png" alt="Ink Insights Logo" />
        <span class="txt">
          <span class="line1">Ink Insights</span>
          <span class="line2">Dashboard</span>
        </span>
      </a>
    </div>

    <nav class="navlinks">
      <a href="index.html">Home</a>
      <a href="dashboard.html" aria-current="page">Dashboard</a>
      <a href="about.html">About Us</a>
      <a href="faq.html">FAQ/Help</a>
      <a href="contact.html">Contact</a>
    </nav>
    <div class="actions">
      <a class="nav-cta" href="upload.html">START ANALYSIS</a>
      <div id="hamb" class="hamb" role="button" aria-label="Open menu" aria-expanded="false" tabindex="0">
        <span></span><span></span><span></span>
      </div>
    </div>
  </div>
</header>

<aside id="drawer" class="drawer" aria-hidden="true">
  <div class="menu-title">Menu</div>
  <nav class="menu">
    <a href="index.html">Home</a>
    <a href="dashboard.html" aria-current="page">Dashboard</a>
    <a href="about.html">About Us</a>
    <a href="faq.html">FAQ/Help</a>
    <a href="contact.html">Contact</a>
  </nav>
  <div class="drawer-cta-wrap">
    <a class="drawer-cta" href="upload.html">START ANALYSIS</a>
  </div>
</aside>
<div id="scrim" class="scrim" aria-hidden="true"></div>


<!-- ================= MAIN ================= -->
<main class="wrap">
  <h1 class="title">Dashboard</h1>
  <div class="divider"></div>

  <p class="tagline">Choose a feature to see more information.</p>

  <!-- Badges -->
  <div class="row">
    <span class="badge file"><span class="label">File Name:</span> <span class="value" id="fn">none</span></span>
    <span class="badge words"><span class="label">Word Count:</span> <span class="value" id="wc">0000</span></span>
    <span class="badge read"><span class="label">Read Time:</span> <span class="value" id="rt">00 min</span></span>
    <span class="spacer"></span>

    <!-- Export + Delete Buttons -->
  <div class="export-dropdown">
    <button id="exportBtn" class="btn export" type="button">EXPORT ▾</button>
      <div id="exportMenu" class="dropdown-menu">
        <button id="exportPDF" type="button">Export as PDF</button>
        <button id="exportCSV" type="button">Export as CSV</button>
        <button id="exportJSON" type="button">Export as JSON</button>
      </div>
  </div>

    <button id="deleteBtn" class="btn delete" type="button">DELETE</button>
  </div>

  <!-- Summary Box -->
  <section class="panel teal">
    <h2>Summary</h2>
    <div id="summaryBox">
      <div id="summaryText" style="max-width:92%"></div>
    </div>
    <p id="summaryEmpty" class="empty-note">No summary available. Select data to get report.</p>
  </section>

  <!-- Feature Grid -->
  <section class="grid">
    <a class="feature" href="features.html#keywords" aria-label="Open Keywords & Frequencies">
      <div class="panel green">
        <h2>Keywords &amp; Frequencies</h2>
        <div class="chartbox pink">
          <canvas id="keywordsChart" aria-label="Keywords bar chart"></canvas>
        </div>
        <p class="empty-note">No chart available. Select data to get report.</p>
      </div>
    </a>

    <a class="feature" href="features.html#themes" aria-label="Open Themes & Clusters">
      <div class="panel pink">
        <h2>Themes &amp; Clusters</h2>
        <div class="chartbox sage">
          <canvas id="themesChart" aria-label="Themes bubble chart"></canvas>
        </div>
        <p class="empty-note">No chart available. Select data to get report.</p>
      </div>
    </a>

    <a class="feature" href="features.html#sentiment" aria-label="Open Sentiment Overview">
      <div class="panel pink">
        <h2>Sentiment Overview</h2>
        <div class="chartbox sage">
          <canvas id="sentimentChart" aria-label="Sentiment doughnut chart"></canvas>
        </div>
        <p class="empty-note">No chart available. Select data to get report.</p>
      </div>
    </a>

    <a class="feature" href="features.html#emotions" aria-label="Open Emotional Patterns">
      <div class="panel green">
        <h2>Emotional Patterns</h2>
        <div class="chartbox pink">
          <canvas id="emotionsChart" aria-label="Emotions radar chart"></canvas>
        </div>
        <p class="empty-note">No chart available. Select data to get report.</p>
      </div>
    </a>
  </section>

  <p class="empty-note" style="text-align:center;margin-top:18px">
    We automatically remove your report after you export or delete it. Keeping things private and tidy.
  </p>
</main>

<!-- ================= FOOTER ================= -->
<footer>
  <div class="footer-container">
    <div class="footer-brand">
      <h1>Enjoy Writing!</h1>
      <p>Privacy-first data analysis, designed for writers.</p>
    </div>
    <div class="footer-links">
      <a href="faq.html">Privacy Policy</a>
      <a href="faq.html#terms-use">Terms of Use</a>
      <a href="contact.html">Contact</a>
    </div>
  </div>
  <div class="footer-bottom">© 2025 Ink Insights — All rights reserved.</div>
</footer>

<!-- ================= SCRIPTS ================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>



<!-- Drawer (hamburger) -->
<script>
(function(){
  const drawer=document.getElementById('drawer');
  const scrim=document.getElementById('scrim');
  const hamb=document.getElementById('hamb');
  function openDrawer(){
    drawer.classList.add('open');
    scrim.classList.add('show');
    hamb.classList.add('open');
  }
  function closeDrawer(){
    drawer.classList.remove('open');
    scrim.classList.remove('show');
    hamb.classList.remove('open');
  }
  hamb.addEventListener('click',()=>drawer.classList.contains('open')?closeDrawer():openDrawer());
  scrim.addEventListener('click',closeDrawer);
  document.addEventListener('keydown',e=>{if(e.key==='Escape')closeDrawer();});
  document.querySelectorAll('#drawer a').forEach(a=>a.addEventListener('click',closeDrawer));
})();
</script>

<!-- PDF/CSV Export Helper -->
<script>
(function(){
  const exportBtn = document.getElementById('exportBtn');
  const exportDropdown = document.querySelector('.export-dropdown');
  const exportMenu = document.getElementById('exportMenu');

  exportBtn.addEventListener('click', e=>{
    e.stopPropagation();
    exportDropdown.classList.toggle('show');
  });
  document.addEventListener('click', ()=>exportDropdown.classList.remove('show'));

  // PDF preview (html2canvas + jsPDF)
  document.getElementById('exportPDF').addEventListener('click', ()=>{
    exportDropdown.classList.remove('show');
    const main = document.querySelector('main');
    html2canvas(main).then(canvas=>{
      const imgData = canvas.toDataURL('image/png');
      const pdf = new jspdf.jsPDF({orientation:'p',unit:'pt',format:'a4'});
      const w = pdf.internal.pageSize.getWidth();
      const h = pdf.internal.pageSize.getHeight();
      const ratio = Math.min(w / canvas.width, h / canvas.height);
      pdf.addImage(imgData,'PNG',20,20,canvas.width*ratio-40,canvas.height*ratio-40);
      pdf.output('dataurlnewwindow');
    });
  });

  // CSV export
  document.getElementById('exportCSV').addEventListener('click', ()=>{
    exportDropdown.classList.remove('show');
    const txt = document.querySelector('#summaryText')?.innerText || "No data";
    const blob = new Blob([txt], {type:'text/csv;charset=utf-8;'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'ink-insights-export.csv';
    a.click();
    URL.revokeObjectURL(a.href);
  });
})();
</script>



<!-- Modular Dashboard -->
<script type="module" src="dashboard.js"></script>


<script>
  // =================== SAFE LEAVE / NAVIGATION HANDLER ===================

  let leavePromptShown = false;
  let pendingLeaveURL = null;

  function hasReport() {
    return (
      localStorage.getItem("ink_text") ||
      localStorage.getItem("ink_report") ||
      localStorage.getItem("ink_report_meta")
    );
  }

  // ---------- Shared cleanup ----------
  function cleanupPrompt(box) {
    box.classList.remove("show");
    setTimeout(() => {
      box.remove();
      leavePromptShown = false;
    }, 300);
  }

  // ---------- Success Prompt ----------
  function showSuccessPrompt(message = "Action completed successfully.", onClose, title = "Success") {
    document.querySelector(".export-prompt")?.remove();

    const box = document.createElement("div");
    box.className = "export-prompt";
    box.innerHTML = `
      <div class="prompt-overlay"></div>
      <div class="prompt-card">
        <h3>${title}</h3>
        <p>${message}</p>
        <div class="prompt-actions">
          <button id="okSuccess" class="btn keep">OK</button>
        </div>
      </div>
    `;
    document.body.appendChild(box);
    setTimeout(() => box.classList.add("show"), 50);

    document.querySelector("#okSuccess").onclick = () => {
      box.classList.remove("show");
      setTimeout(() => {
        box.remove();
        if (typeof onClose === "function") onClose();
      }, 300);
    };

    box.querySelector(".prompt-overlay").addEventListener("click", () => {
      document.querySelector("#okSuccess").click();
    });
  }

  // ---------- Loading Bar + Success Message ----------
  function showDeleteProcess(onDone) {
    document.querySelector(".delete-overlay")?.remove();

    const overlay = document.createElement("div");
    overlay.className = "delete-overlay";
    overlay.innerHTML = `
      <div class="delete-box">
        <h3>Your data is being deleted...</h3>
        <div class="progress-bar"><div class="bar-fill"></div></div>
      </div>
    `;
    document.body.appendChild(overlay);

    // start progress animation
    const fill = overlay.querySelector(".bar-fill");
    if (fill) setTimeout(() => (fill.style.width = "100%"), 100);

    // helper utilities
    const $ = (s) => document.querySelector(s);
    const safe = (fn) => { try { fn(); } catch (e) { console.warn(e); } };

    // total animation ~7s
    setTimeout(() => {
      // clear local storage
      safe(() => {
        ["ink_text", "ink_report_meta", "ink_report", "ink_results"].forEach(k =>
          localStorage.removeItem(k)
        );
      });

      // destroy charts safely
      safe(() => {
        if (typeof destroyCharts === "function") destroyCharts(window.charts || []);
      });

      // reset canvases
      ["#keywordsChart", "#themesChart", "#sentimentChart", "#emotionsChart"].forEach(sel => {
        safe(() => {
          const c = document.querySelector(sel);
          if (c) c.replaceWith(c.cloneNode(false));
          if (typeof setChartStateByCanvas === "function") {
            setChartStateByCanvas(sel, { loading: true, hasData: false });
          }
        });
      });

      // reset summary UI
      safe(() => {
        if ($("#summaryText")) $("#summaryText").textContent = "";
        if ($("#summaryEmpty")) $("#summaryEmpty").style.display = "block";
        if ($("#fn")) $("#fn").textContent = "none";
        if ($("#wc")) $("#wc").textContent = "0000";
        if ($("#rt")) $("#rt").textContent = "00 min";
      });

      // fade out overlay and show success
      overlay.classList.add("fade-out");
      setTimeout(() => {
        overlay.remove();
        showSuccessPrompt(
          "Your report was successfully deleted.",
          () => {
            setTimeout(() => {
              if (typeof onDone === "function") onDone();
              else window.location.href = "upload.html";
            }, 400);
          },
          "Success"
        );
      }, 800);
    }, 7000);
  }

  // ---------- Page Navigation Prompt ----------
  function showLeavePrompt(onDelete = null, onStay = null) {
    if (leavePromptShown || !hasReport()) return;
    leavePromptShown = true;

    const box = document.createElement("div");
    box.className = "export-prompt";
    box.innerHTML = `
      <div class="prompt-overlay"></div>
      <div class="prompt-card">
        <h3>Leave dashboard?</h3>
        <p>Your analysis data is still stored locally. Would you like to delete it before leaving this page?</p>
        <div class="prompt-actions">
          <button id="stayHere" class="btn keep">Stay on Dashboard</button>
          <button id="deleteBeforeLeave" class="btn delete">Delete Data & Leave</button>
        </div>
      </div>
    `;
    document.body.appendChild(box);
    setTimeout(() => box.classList.add("show"), 50);

    document.querySelector("#stayHere").onclick = () => {
      cleanupPrompt(box);
      pendingLeaveURL = null;
      if (onStay) onStay();
    };

    document.querySelector("#deleteBeforeLeave").onclick = () => {
      cleanupPrompt(box);
      showDeleteProcess(() => {
        if (onDelete) onDelete();
        else if (pendingLeaveURL) window.location.href = pendingLeaveURL;
        else window.location.href = "upload.html";
      });
    };
  }

  // ---------- Mouse Leave (Tab Exit) Prompt ----------
  function showExitIntentPrompt() {
    if (leavePromptShown || !hasReport()) return;
    leavePromptShown = true;

    const box = document.createElement("div");
    box.className = "export-prompt";
    box.innerHTML = `
      <div class="prompt-overlay"></div>
      <div class="prompt-card">
        <h3>Are you leaving?</h3>
        <p>Your analysis data is saved locally. Would you like to delete it before leaving the dashboard?</p>
        <div class="prompt-actions">
          <button id="stayHere" class="btn keep">Stay on Page</button>
          <button id="deleteBeforeLeave" class="btn delete">Delete Data</button>
        </div>
      </div>
    `;
    document.body.appendChild(box);
    setTimeout(() => box.classList.add("show"), 50);

    document.querySelector("#stayHere").onclick = () => cleanupPrompt(box);
    document.querySelector("#deleteBeforeLeave").onclick = () => {
      cleanupPrompt(box);
      showDeleteProcess(() => window.location.href = "upload.html");
    };
  }

  // --- Intercept internal navigation links ---
  document.addEventListener("click", (e) => {
    const link = e.target.closest("a[href]");
    if (!link) return;

    const href = link.getAttribute("href");
    if (!href) return;

    if (href.startsWith("#") || href.startsWith("javascript:")) return;
    if (href.includes("features.html")) return;

    const protectedPages = ["index.html", "about.html", "faq.html", "contact.html"];
    const shouldPrompt = protectedPages.some(page => href.includes(page));

    if (shouldPrompt && hasReport()) {
      e.preventDefault();
      pendingLeaveURL = href;
      showLeavePrompt(
        () => (window.location.href = pendingLeaveURL),
        () => (pendingLeaveURL = null)
      );
    }
  });

  // --- Optional soft exit-intent (cursor leaves window top) ---
  let lastPromptTime = 0;
  document.addEventListener("mouseleave", (e) => {
    const now = Date.now();
    if (e.clientY <= 0 && now - lastPromptTime > 1000 && hasReport()) {
      showExitIntentPrompt();
      lastPromptTime = now;
    }
  });

  // --- On reload, restore cached results ---
  window.addEventListener("DOMContentLoaded", () => {
    try {
      const hasCachedResults = localStorage.getItem("ink_results");
      if (hasCachedResults) {
        if (typeof window.skipBackendProcessing === "function") {
          window.skipBackendProcessing();
        }
        const cachedResults = JSON.parse(hasCachedResults);
        if (typeof window.renderCachedResults === "function") {
          window.renderCachedResults(cachedResults);
        }
      }
    } catch (err) {
      console.warn("Dashboard reload cache restore failed:", err);
    }
  });
</script>




</body>
</html>
