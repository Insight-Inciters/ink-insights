<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ink Insights — Features</title>
<link rel="icon" href="assests/Ink-logo.png" type="image/png" />
<link rel="stylesheet" href="features.css">
</head>


  
<body>
  <!-- ====== HEADER ====== -->
  <header class="navbar">
    <div class="nav-inner">
      <div class="brand">
        <a href="index.html" aria-label="Go to Home">
          <img src="assests/Ink-logo.png" alt="Ink Insights Logo" />
          <span class="txt"><span class="line1">Ink Insights</span><span class="line2">Features</span></span>
        </a>
      </div>
      <nav class="navlinks" aria-label="Main">
        <a href="index.html">Home</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="about.html">About Us</a>
        <a href="faq.html">FAQ/Help</a>
        <a href="contact.html">Contact</a>
      </nav>
      <div class="actions">
        <a class="nav-cta" href="upload.html">START ANALYSIS</a>
        <div id="hamb" class="hamb" role="button" aria-label="Open menu" aria-expanded="false" tabindex="0">
          <span></span><span></span><span></span>
        </div>
      </div>
    </div>
  </header>

  <aside id="drawer" class="drawer" aria-hidden="true">
    <div class="menu-title">Menu</div>
    <nav class="menu">
      <a href="index.html">Home</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="about.html">About Us</a>
      <a href="faq.html">FAQ/Help</a>
      <a href="contact.html">Contact</a>
    </nav>
    <div class="drawer-cta-wrap"><a class="drawer-cta" href="upload.html">START ANALYSIS</a></div>
  </aside>
  <div id="scrim" class="scrim" aria-hidden="true"></div>

  <!-- ====== CONTENT ====== -->
  <main class="wrap">

    <!-- CENTERED feature options (tabs) -->
    <div class="feature-tabs" role="tablist" aria-label="Features">
      <button class="feature-tab" role="tab" data-target="keywords" aria-controls="keywords" aria-selected="false" tabindex="-1">KEYWORDS</button>
      <button class="feature-tab" role="tab" data-target="themes" aria-controls="themes" aria-selected="false" tabindex="-1">THEMES</button>
      <button class="feature-tab" role="tab" data-target="sentiment" aria-controls="sentiment" aria-selected="false" tabindex="-1">SENTIMENTS</button>
      <button class="feature-tab" role="tab" data-target="emotions" aria-controls="emotions" aria-selected="false" tabindex="-1">EMOTIONAL</button>
    </div>

    <!-- ====== KEYWORDS ====== -->
    <section id="keywords" class="feature-section" aria-labelledby="kw-title" role="tabpanel" tabindex="0">
      <div class="row">
        <button class="btn back" id="backKw" type="button">GO BACK</button>
        <span class="spacer"></span>
        <div class="export-dropdown">
  <button class="btn export" id="exportBtn" type="button">EXPORT ▼</button>
  <div class="dropdown-menu" id="exportMenu">
    <button id="exportPDF">Export as PDF</button>
    <button id="exportJSON">Export as JSON</button>
    <button id="exportCSV">Export as CSV</button>
  </div>
</div>

      </div>

      <h1 class="title" id="kw-title">Keyword &amp; Frequencies</h1>
      <div class="divider"></div>
      <p class="subtitle">See the words that define your writing. Get a quick overview of the most used or distinctive words, recurring patterns, or overused terms.</p>
       
       <h2 class=suggestion-heading>Overview</h2>
      <div class="panel green">
        <div class="m-badges">
          <span class="m-badge">Unique Words: <span class="value" id="kw-unique">00</span></span>
          <span class="m-badge">Top Keyword: <span class="value" id="kw-top">—</span></span>
        </div>
          <div class="chartbox pink" id="kw-frequency">Keyword Frequency Graph</div>
        </div>
      </div>

      <h2 class=suggestion-heading>Highlighted Word</h2>
      <div class="panel green">
        <div class="kw-highlight">
          <div class="kw-list">
            <h3>Keywords</h3>
            <div class="kw-scroll" id="kw-list"></div>
          </div>
          <div class="kw-doc">
            <h3>Your Document</h3>
            <div class="kw-scroll" id="kw-doc">Select a keyword to preview text with <mark>highlights</mark>. This area scrolls; content does not expand the box.</div>
          </div>
        </div>
      </div>

      <div>
        <h2 class = suggestion-heading >Suggestions</h2>
        <div id="kw-suggestions"></div>
      </div>
    </section>

    <!-- ====== THEMES ====== -->
    <section id="themes" class="feature-section" aria-labelledby="th-title" role="tabpanel" tabindex="0">
      <div class="row">
        <button class="btn back" id="backTh" type="button">GO BACK</button>
        <span class="spacer"></span>
        <button class="btn export" id="exportTh" type="button">EXPORT</button>
      </div>

      <h1 class="title" id="th-title">Themes &amp; Clusters</h1>
      <div class="divider"></div>
      <p class="subtitle">Uncover deeper themes within your text. Visualize how ideas group and connect.</p>

      <h2 class=suggestion-heading>Overview</h2>
      <div class="panel pink">
        <div class="m-badges">
          <span class="m-badge">Clusters: <span class="value" id="th-count">00</span></span>
          <span class="m-badge">Top Theme: <span class="value" id="th-top">—</span></span>
        </div>
        <div class="chartbox pink" id="th-graph">Graph</div>
        <div class="chartbox blue" id="th-desc">Graph</div>
      </div>

      <div>
        <h2 class = suggestion-heading >Suggestions</h2>
        <div id="th-suggestions"></div>
      </div>
    </section>

    <!-- ====== SENTIMENT ====== -->
    <section id="sentiment" class="feature-section" aria-labelledby="se-title" role="tabpanel" tabindex="0">
      <div class="row">
        <button class="btn back" id="backSe" type="button">GO BACK</button>
        <span class="spacer"></span>
        <button class="btn export" id="exportSe" type="button">EXPORT</button>
      </div>

      <h1 class="title" id="se-title">Sentiments</h1>
      <div class="divider"></div>
      <p class="subtitle">Understand the emotional balance of your writing across positive, neutral, and negative tones.</p>

      <h2 class=suggestion-heading>Overview</h2>
      <div class="panel blue">
        <div class="m-badges">
          <span class="m-badge positive">Positive: <span class="value" id="se-pos">00%</span></span>
          <span class="m-badge neutral">Neutral: <span class="value" id="se-neu">00%</span></span>
          <span class="m-badge negative">Negative: <span class="value" id="se-neg">00%</span></span>
        </div>
        <div class="grid">
          <div class="chartbox pink" id="se-donut">Donut Graph</div>
          <div class="chartbox blue" id="se-timeline">Timeline Graph</div>
        </div>
      </div>

      <div>
        <h2 class = suggestion-heading >Suggestions</h2>
        <div id="se-suggestions"></div>
      </div>
    </section>

    <!-- ====== EMOTIONS ====== -->
    <section id="emotions" class="feature-section" aria-labelledby="em-title" role="tabpanel" tabindex="0">
      <div class="row">
        <button class="btn back" id="backEm" type="button">GO BACK</button>
        <span class="spacer"></span>
        <button class="btn export" id="exportEm" type="button">EXPORT</button>
        <div id="exportMenu" class="dropdown-menu">
        <button id="exportPDF" type="button">Export as PDF</button>
        <button id="exportCSV" type="button">Export as CSV</button>
        <button id="exportJSON" type="button">Export as JSON</button>
      </div>
      </div>

      <h1 class="title" id="em-title">Emotional Patterns</h1>
      <div class="divider"></div>
      <p class="subtitle">Explore the emotional and sensory landscape of your story.</p>

      <h2 class=suggestion-heading>Overview</h2>
      <div class="panel green">
        <div class="m-badges">
          <span class="m-badge">Dominant Emotion: <span class="value" id="em-dominant">—</span></span>
        </div>
        <div class="grid">
          <div class="chartbox pink" id="em-graph-1">Graph</div>
          <div class="chartbox blue" id="em-graph-2">Graph</div>
        </div>
        <div class="chartbox sage" id="em-arc">Emotional Arc Graph</div>
      </div>

      <div>
        <h2 class = suggestion-heading >Suggestions</h2>
        <div id="em-suggestions"></div>
      </div>
    </section>
  </main>


<script defer src="js/dashboard.js"></script>
<script defer type="module" src="js/features.js"></script>


<canvas id="kw-frequency"></canvas>
<canvas id="kw-ngram"></canvas>
<canvas id="th-graph"></canvas>
<canvas id="th-desc"></canvas>
<canvas id="se-donut"></canvas>
<canvas id="se-timeline"></canvas>
<canvas id="em-graph-1"></canvas>
<canvas id="em-arc"></canvas>



<footer>
  <div class="footer-container">
    <div class="footer-brand">
      <h1>Enjoy Writing!</h1>
      <p>Privacy-first data analysis, designed for writers.</p>
    </div>
    <div class="footer-links">
      <a href="#">Privacy Policy</a>
      <a href="#">Terms of Use</a>
      <a href="contact.html">Contact</a>
    </div>
  </div>
  <div class="footer-bottom">
    © 2025 Ink Insights — All rights reserved.
  </div>
</footer>


<script>
(function(){
  // Dropdown open/close
  const exportBtn = document.getElementById('exportBtn');
  const exportDropdown = document.querySelector('.export-dropdown');
  const exportMenu = document.getElementById('exportMenu');

  exportBtn.addEventListener('click', (e)=>{
    e.stopPropagation();
    exportDropdown.classList.toggle('show');
  });

  document.addEventListener('click', ()=>exportDropdown.classList.remove('show'));

  // Export handlers
  const exportPDF = document.getElementById('exportPDF');
  const exportCSV = document.getElementById('exportCSV');

  exportPDF.addEventListener('click', ()=>{
    exportDropdown.classList.remove('show');
    openPDFPreview();
  });

  exportCSV.addEventListener('click', ()=>{
    exportDropdown.classList.remove('show');
    exportAsCSV();
  });

  // PDF preview function
  function openPDFPreview(){
    // This uses html2canvas + jsPDF (already loaded)
    const main = document.querySelector('main');
    html2canvas(main).then(canvas=>{
      const imgData = canvas.toDataURL('image/png');
      const pdf = new jspdf.jsPDF({orientation: 'p', unit: 'pt', format: 'a4'});
      const width = pdf.internal.pageSize.getWidth();
      const height = pdf.internal.pageSize.getHeight();
      const ratio = Math.min(width / canvas.width, height / canvas.height);
      pdf.addImage(imgData, 'PNG', 20, 20, canvas.width * ratio - 40, canvas.height * ratio - 40);
      pdf.output('dataurlnewwindow'); // open preview tab
      askDeletePermission();
    });
  }

  // CSV export function
  function exportAsCSV(){
    const content = document.querySelector('#summaryText')?.innerText || "No data";
    const blob = new Blob([content], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'ink-insights-export.csv';
    link.click();
    URL.revokeObjectURL(url);
    askDeletePermission();
  }

  // Ask permission to delete data
  function askDeletePermission(){
    setTimeout(()=>{
      if(confirm("Export completed.\nWould you like to delete your data now?")){
        deleteData();
      }
    }, 400);
  }

function deleteData(){
  // clear summary & show empty note
  document.getElementById('summaryText').innerText = "";
  document.getElementById('summaryEmpty').style.display = "block";

  // optional: clear badges too
  document.getElementById('fn').innerText = "none";
  document.getElementById('wc').innerText = "0000";
  document.getElementById('rt').innerText = "00 min";

  // success confirmation
  setTimeout(()=>{
    alert("✅ Your data has been deleted successfully.");
  }, 300);
}


})();
</script>


<script>
(function(){
  /* ===== Drawer & header behavior ===== */
  const els = {
    drawer:document.getElementById('drawer'),
    hamb:document.getElementById('hamb'),
    scrim:document.getElementById('scrim'),
  };
  function openDrawer(){els.drawer.classList.add('open');els.drawer.setAttribute('aria-hidden','false');els.scrim.classList.add('show');els.scrim.setAttribute('aria-hidden','false');els.hamb.classList.add('open');els.hamb.setAttribute('aria-expanded','true')}
  function closeDrawer(){els.drawer.classList.remove('open');els.drawer.setAttribute('aria-hidden','true');els.scrim.classList.remove('show');els.scrim.setAttribute('aria-hidden','true');els.hamb.classList.remove('open');els.hamb.setAttribute('aria-expanded','false')}
  function toggleDrawer(){(els.drawer.classList.contains('open')?closeDrawer:openDrawer)()}
  els.hamb.addEventListener('click',toggleDrawer);
  els.hamb.addEventListener('keypress',e=>{if(e.key==='Enter'||e.key===' ') toggleDrawer();});
  els.scrim.addEventListener('click',closeDrawer);
  document.addEventListener('keydown',e=>{if(e.key==='Escape') closeDrawer();});

  /* ===== Tab system: single-page switcher (centered options) ===== */
  const tabs = Array.from(document.querySelectorAll('.feature-tab'));
  const sections = Array.from(document.querySelectorAll('.feature-section'));
  const idToTab = Object.fromEntries(tabs.map(t=>[t.dataset.target, t]));

  function activate(targetId, {focusPanel=false} = {}){
    // toggle tab active styles + ARIA
    tabs.forEach(t=>{
      const on = (t.dataset.target === targetId);
      t.classList.toggle('active', on);
      t.setAttribute('aria-selected', on ? 'true' : 'false');
      t.tabIndex = on ? 0 : -1;
    });
    // show only one section
    sections.forEach(s=>{
      s.classList.toggle('active', s.id === targetId);
      s.hidden = (s.id !== targetId);
    });
    // persist selection for roundtrips
    try{ localStorage.setItem('ink_target_section', targetId); }catch{}
    // update URL hash without jump
    history.replaceState(null,'',`#${targetId}`);
    // optional focus for accessibility
    if(focusPanel){ document.getElementById(targetId).focus({preventScroll:true}); }
  }

  // click/keyboard handlers
  tabs.forEach((tab, idx)=>{
    tab.addEventListener('click', ()=> activate(tab.dataset.target, {focusPanel:true}));
    tab.addEventListener('keydown', e=>{
      const k=e.key;
      let nextIdx = idx;
      if(k==='ArrowRight') nextIdx = (idx+1)%tabs.length;
      else if(k==='ArrowLeft') nextIdx = (idx-1+tabs.length)%tabs.length;
      else if(k==='Home') nextIdx = 0;
      else if(k==='End') nextIdx = tabs.length-1;
      else if(k==='Enter' || k===' ') { activate(tab.dataset.target, {focusPanel:true}); return; }
      else return;
      e.preventDefault();
      tabs[nextIdx].focus();
      activate(tabs[nextIdx].dataset.target);
    });
  });





  // init: prefer hash, then localStorage, else keywords
  const initial = (location.hash||'').replace('#','') || (localStorage.getItem('ink_target_section')||'keywords');
  // make sure only one visible at start
  sections.forEach(s=>{ s.hidden = true; s.classList.remove('active'); });
  activate(initial);

  // Back buttons
btn.addEventListener('click', ()=>{
  // Always go to dashboard if not returning from it directly
  if (document.referrer && document.referrer.includes('dashboard.html')) {
    history.back();
  } else {
    window.location.href = 'dashboard.html';
  }
});


  // ===== API render stubs (same as before) =====
  window.renderKeywords = function(data){
    document.getElementById('kw-unique').textContent = (data.unique ?? 0).toLocaleString();
    document.getElementById('kw-top').textContent = data.top ?? '—';
    const list = document.getElementById('kw-list');
    list.innerHTML = '';
    (data.list||[]).forEach(item=>{
      const a = document.createElement('a');
      a.href="#";
      a.textContent = `${item.token} — ${item.count}`;
      a.style.display='block'; a.style.padding='6px 2px';
      a.addEventListener('click', (e)=>{
        e.preventDefault();
        const doc = data.previewHtml?.[item.token] || (data.previewText || '').replace(new RegExp(`\\b(${item.token})\\b`,'gi'),'<mark>$1</mark>');
        document.getElementById('kw-doc').innerHTML = doc || '<em>No preview available.</em>';
      });
      list.appendChild(a);
    });
  };

  window.renderThemes = function(data){
    document.getElementById('th-count').textContent = data.clusters ?? 0;
    document.getElementById('th-top').textContent = Array.isArray(data.top_theme)? data.top_theme.join('/') : (data.top_theme||'—');
  };

  window.renderSentiment = function(data){
    document.getElementById('se-pos').textContent = (data.pos??0) + '%';
    document.getElementById('se-neu').textContent = (data.neu??0) + '%';
    document.getElementById('se-neg').textContent = (data.neg??0) + '%';
  };

  window.renderEmotions = function(data){
    document.getElementById('em-dominant').textContent = data.dominant || '—';
  };

  // Demo exports (disable in prod)
  document.querySelectorAll('.btn.export').forEach(b=>b.addEventListener('click',()=>alert('Export is disabled in demo mode. Connect jsPDF or your backend to enable.')));
})();
</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const uniqueEl = document.getElementById("kw-unique");
  const topEl = document.getElementById("kw-top");

  if (!uniqueEl || !topEl) return;

  // Try to read stored analysis first
  const report = JSON.parse(
    localStorage.getItem("ink_report") ||
    localStorage.getItem("ink_results") ||
    "null"
  ) || {};
  const kw = report.keywords || {};
  const text = (localStorage.getItem("ink_text") || "").trim();

  let uniqueCount = 0;
  let topWord = "—";

  // --- Priority 1: use backend results if they exist ---
  if (kw.unique && kw.top) {
    uniqueCount = kw.unique;
    topWord = kw.top;

  // --- Priority 2: calculate from keyword list if present ---
  } else if (Array.isArray(kw.list) && kw.list.length) {
    const tokens = kw.list.map(i => i.token || i.term || i.word).filter(Boolean);
    uniqueCount = new Set(tokens.map(w => w.toLowerCase())).size;
    const top = kw.list[0];
    topWord = top.token || top.term || top.word || "—";

  // --- Priority 3: derive from raw text if no keyword data ---
  } else if (text) {
    // Clean and split words (English letters only, case-insensitive)
    const words = text.toLowerCase().match(/\b[a-z']+\b/g) || [];
    const freq = {};
    for (const w of words) freq[w] = (freq[w] || 0) + 1;

    uniqueCount = Object.keys(freq).length;

    // Find top keyword (highest count)
    const topEntry = Object.entries(freq).sort((a, b) => b[1] - a[1])[0];
    if (topEntry) topWord = topEntry[0];
  }

  // --- Display results ---
  uniqueEl.textContent = uniqueCount.toLocaleString();
  topEl.textContent = topWord.charAt(0).toUpperCase() + topWord.slice(1);
});
</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const cards = document.querySelectorAll(".title, .suggestion-item, .suggestion-heading");
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add("visible");
        observer.unobserve(entry.target); // animate once
      }
    });
  }, { threshold: 0.2 }); // triggers when 20% of card visible

  cards.forEach(card => observer.observe(card));
});
</script>


<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script type="module" src="./viz.js"></script>
<script type="module" src="js/features.js"></script>

</body>
</html>
